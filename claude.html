<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced AI Chatbot</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #f5f5f5;
            --text-color: #333;
            --bot-message-bg: #f0f0f0;
            --user-message-bg: #4a90e2;
            --user-message-color: white;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .chat-container {
            width: 90%;
            max-width: 1000px;
            height: 80vh;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background: var(--primary-color);
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .bot-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .bot-avatar {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .bot-status {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #4CAF50;
            border-radius: 50%;
        }

        .chat-messages {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: #fafafa;
        }

        .message {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 15px;
            position: relative;
            animation: messageAppear 0.3s ease-out;
        }

        @keyframes messageAppear {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-message {
            background: var(--user-message-bg);
            color: var(--user-message-color);
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }

        .bot-message {
            background: var(--bot-message-bg);
            color: var(--text-color);
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }

        .message-time {
            font-size: 0.7em;
            opacity: 0.7;
            margin-top: 5px;
            text-align: right;
        }

        .chat-input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #eee;
        }

        .chat-input-wrapper {
            display: flex;
            gap: 10px;
            background: #f8f9fa;
            border-radius: 30px;
            padding: 10px;
            align-items: center;
        }

        .chat-input {
            flex-grow: 1;
            border: none;
            background: transparent;
            padding: 10px;
            outline: none;
            font-size: 1em;
        }

        .chat-controls {
            display: flex;
            gap: 10px;
        }

        .control-button {
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background-color 0.3s;
            color: #666;
        }

        .control-button:hover {
            background: #eee;
        }

        .send-button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .send-button:hover {
            background: #357abd;
        }

        .typing-indicator {
            display: none;
            align-self: flex-start;
            background: var(--bot-message-bg);
            padding: 12px 16px;
            border-radius: 15px;
            border-bottom-left-radius: 5px;
        }

        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #90a4ae;
            border-radius: 50%;
            margin-right: 5px;
            animation: typing 1s infinite;
        }

        @keyframes typing {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

        .suggestions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .suggestion {
            background: #e3f2fd;
            padding: 8px 15px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s;
        }

        .suggestion:hover {
            background: #bbdefb;
        }

        /* Responsives Design */
        @media (max-width: 768px) {
            .chat-container {
                width: 100%;
                height: 100vh;
                border-radius: 0;
            }

            .message {
                max-width: 85%;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <div class="bot-info">
                <div class="bot-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div>
                    <h2>AI Assistant</h2>
                    <div class="bot-status">
                        <span class="status-dot"></span>
                        <span>Online</span>
                    </div>
                </div>
            </div>
            <div class="header-controls">
                <button class="control-button" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="message bot-message">
                Hallo! Ich bin dein AI Assistent. Ich kann dir bei vielen Themen helfen und unterstütze auch Spracheingabe. 
                Wie kann ich dir heute helfen?
            </div>
        </div>

        <div class="typing-indicator" id="typingIndicator">
            <span></span>
            <span></span>
            <span></span>
        </div>

        <div class="chat-input-container">
            <div class="suggestions" id="suggestions">
                <!-- Vorschläge werden dynamisch hinzugefügt -->
            </div>
            <div class="chat-input-wrapper">
                <button class="control-button" onclick="startVoiceInput()">
                    <i class="fas fa-microphone"></i>
                </button>
                <input type="text" class="chat-input" id="userInput" 
                       placeholder="Schreibe eine Nachricht..." autocomplete="off"/>
                <div class="chat-controls">
                    <button class="control-button" onclick="toggleTextToSpeech()">
                        <i class="fas fa-volume-up"></i>
                    </button>
                    <button class="send-button" onclick="sendMessage()">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Konstanten und Variablen
        const chatMessages = document.getElementById('chatMessages');
        const userInput = document.getElementById('userInput');
        const typingIndicator = document.getElementById('typingIndicator');
        const suggestions = document.getElementById('suggestions');
        let textToSpeechEnabled = false;
        let darkMode = false;

        // Vorschläge für häufige Fragen
        const commonQuestions = [
            'Was kannst du?',
            'Erzähl mir einen Witz',
            'Wie ist das Wetter?',
            'Hilf mir bei einem Problem'
        ];

        // Wissensbank für den Chatbot
        const knowledgeBase = {
            'hallo': ['Hallo! Wie geht es dir?', 'Hi! Schön dich zu sehen!', 'Guten Tag! Wie kann ich dir helfen?'],
            'wie geht es dir': ['Mir geht es gut, danke! Wie kann ich dir helfen?', 'Bestens! Bereit dir zu helfen!'],
            'wer bist du': ['Ich bin ein AI Chatbot, entwickelt um dir zu helfen!', 'Ich bin dein digitaler Assistent.'],
            'was kannst du': ['Ich kann dir bei vielen Themen helfen, Gespräche führen, Witze erzählen und mehr!'],
            'danke': ['Gerne!', 'Kein Problem!', 'Immer wieder gerne!'],
            'tschüss': ['Auf Wiedersehen!', 'Bis bald!', 'Schönen Tag noch!'],
            'witz': [
                'Warum können Skelette schlecht lügen? Weil sie so durchschaubar sind!',
                'Was macht ein Clown im Büro? Faxen!',
                'Treffen sich zwei Magnete. Sagt der eine: "Was soll ich heute anziehen?"'
            ]
        };

        // Event Listener
        document.addEventListener('DOMContentLoaded', () => {
            showSuggestions();
            userInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
            userInput.addEventListener('input', handleInput);
        });

        // Hauptfunktionen
        function sendMessage() {
            const message = userInput.value.trim();
            if (message === '') return;

            addMessage(message, 'user-message');
            userInput.value = '';

            // Typing-Indikator anzeigen
            typingIndicator.style.display = 'block';
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Verzögerung für realistischere Interaktion
            setTimeout(() => {
                typingIndicator.style.display = 'none';
                const response = generateResponse(message);
                addMessage(response, 'bot-message');
                
                if (textToSpeechEnabled) {
                    speakText(response);
                }
            }, 1000 + Math.random() * 1500);
        }

        function addMessage(text, className) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${className}`;
            messageDiv.innerHTML = `
                ${text}
                <div class="message-time">${getCurrentTime()}</div>
            `;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function generateResponse(message) {
            message = message.toLowerCase();
            
            // Prüfe auf exakte Übereinstimmungen
            for (let key in knowledgeBase) {
                if (message.includes(key)) {
                    const responses = knowledgeBase[key];
                    return responses[Math.floor(Math.random() * responses.length)];
                }
            }

            // Sentiment-Analyse für kontextbezogene Antworten
            const sentiment = analyzeSentiment(message);
            if (sentiment > 0) {
                return "Das freut mich zu hören! Wie kann ich dir weiter helfen?";
            } else if (sentiment < 0) {
                return "Das tut mir leid zu hören. Kann ich dir irgendwie helfen?";
            }

            // Fallback-Antworten
            const fallbackResponses = [
                "Interessant! Erzähl mir mehr darüber.",
                "Ich verstehe. Wie kann ich dir dabei helfen?",
                "Das ist ein spannendes Thema! Lass uns mehr darüber reden.",
                "Könntest du das anders formulieren?",
                "Darüber würde ich gerne mehr erfahren."
            ];

            return fallbackResponses[Math.floor(Math.random() * fallbackResponses.length)];
        }

        // Hilfsfunktionen
        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleTimeString('de-DE', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }

        function analyzeSentiment(message) {
            const positiveWords = ['gut', 'toll', 'super', 'klasse', 'schön', 'froh', 'glücklich'];
            const negativeWords = ['schlecht', 'traurig', 'ärgerlich', 'böse', 'schwierig', 'problematisch'];
            
            let sentiment = 0;
            const words = message.toLowerCase().split(' ');
            
            words.forEach(word => {
                if (positiveWords.includes(word)) sentiment++;
                if (negativeWords.includes(word)) sentiment--;
            });
            
            return sentiment;
        }

        function showSuggestions() {
            suggestions.innerHTML = '';
            commonQuestions.forEach(question => {
                const suggestionDiv =